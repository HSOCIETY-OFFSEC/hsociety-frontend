import{u as e,j as s}from"./index-Cp6IXOH3.js";import{r as a}from"./react-vendor-Dt--M4EP.js";import{N as t,g as r,h as i,i as l,C as n,j as c,F as d,B as o,k as m}from"./Card-C1qsx9RO.js";import{u as p}from"./useScrollReveal-BC-245pq.js";import{S as u}from"./Skeleton-DteAVSoX.js";import{v as h}from"./input.validator-7PKJK-co.js";import{a as g,A as x}from"./api.client-Bi3E9hB6.js";import"./icons-9q4Ww-N4.js";const j=(e=[])=>e.map(e=>({id:String(e.id||""),type:e.type||"Security Test",target:e.target||"",status:e.status||"scheduled",startDate:e.startDate||null,estimatedCompletion:e.estimatedCompletion||null,completedDate:e.completedDate||null,scheduledDate:e.scheduledDate||null,tester:e.tester||"Security Team",reportAvailable:Boolean(e.reportAvailable)})),v=()=>{const{user:v}=e(),[N,f]=a.useState("request"),[y,b]=a.useState(!1),[w,D]=a.useState([]),[S,q]=a.useState(""),[T,C]=a.useState({targetType:"web-application",targetUrl:"",targetDescription:"",scope:"",preferredDate:"",urgency:"normal",additionalNotes:""}),[F,k]=a.useState({}),[U,A]=a.useState(!1);p(".reveal-on-scroll",{},[N,y,w.length]),a.useEffect(()=>{"request"!==N&&P()},[N]);const P=async()=>{b(!0),q("");try{const e=await(async()=>{var e;const s=await g.get(x.PENTEST.LIST);return s.success?{success:!0,data:j(Array.isArray(s.data)?s.data:(null==(e=s.data)?void 0:e.items)||[])}:{success:!1,error:s.error||"Failed to load engagements"}})();if(!e.success)throw new Error(e.error||"Failed to load engagements");D(e.data)}catch(e){console.error("Failed to load engagements:",e),q("Failed to load engagements.")}finally{b(!1)}},R=e=>{const{name:s,value:a}=e.target;C(e=>({...e,[s]:a})),F[s]&&k(e=>({...e,[s]:""}))},E=async e=>{e.preventDefault(),k({}),A(!1);const s=h(T,{targetUrl:{required:!0,type:"url"},targetDescription:{required:!0,minLength:20},scope:{required:!0,minLength:10},preferredDate:{required:!0}});if(s.isValid){b(!0);try{const e=await(async e=>{const s={target:{type:(a=e).targetType,identifier:a.targetUrl.trim(),description:a.targetDescription.trim()},scope:a.scope.trim(),schedule:{preferredStartDate:a.preferredDate},priority:a.urgency,notes:(null==(t=a.additionalNotes)?void 0:t.trim())||"",metadata:{source:"web",version:"1"}};var a,t;const r=await g.post(x.PENTEST.CREATE,s);return r.success?{success:!0,data:r.data}:{success:!1,error:r.error||"Failed to submit pentest request"}})(s.sanitizedData);if(!e.success)throw new Error(e.error||"Failed to submit request");console.log("Pentest request submitted:",s.sanitizedData),A(!0),C({targetType:"web-application",targetUrl:"",targetDescription:"",scope:"",preferredDate:"",urgency:"normal",additionalNotes:""}),setTimeout(()=>{f("active")},2e3)}catch(a){k({submit:"Failed to submit request. Please try again."}),console.error("Pentest request failed:",a)}finally{b(!1)}}else k(s.errors)},z=e=>{switch(e){case"scheduled":return"#3b82f6";case"in-progress":return"#f59e0b";case"completed":return"#10b981";case"cancelled":return"#ef4444";default:return"#6b7280"}},I=e=>{switch(e){case"scheduled":return"Scheduled";case"in-progress":return"In Progress";case"completed":return"Completed";case"cancelled":return"Cancelled";default:return"Unknown"}},L=e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),B=e=>{const a="active"===e?w.filter(e=>["scheduled","in-progress"].includes(e.status)):w.filter(e=>["completed","cancelled"].includes(e.status));return y?s.jsx("div",{className:"engagements-grid",children:[...Array(3)].map((e,a)=>s.jsx(n,{padding:"large",shadow:"medium",children:s.jsxs("div",{className:"engagement-card",children:[s.jsxs("div",{className:"engagement-header",children:[s.jsx(u,{className:"skeleton-line",style:{width:"180px"}}),s.jsx(u,{className:"skeleton-line",style:{width:"90px",height:"20px"}})]}),s.jsx("div",{className:"engagement-details",children:[...Array(3)].map((e,a)=>s.jsxs("div",{className:"detail-item",children:[s.jsx(u,{className:"skeleton-line",style:{width:"80px"}}),s.jsx(u,{className:"skeleton-line",style:{width:"140px"}})]},a))}),s.jsxs("div",{className:"engagement-footer",children:[s.jsx(u,{className:"skeleton-line",style:{width:"140px"}}),s.jsx(u,{className:"skeleton-rect",style:{width:"110px",height:"36px",borderRadius:"8px"}})]})]})},a))}):0===a.length?s.jsx(n,{padding:"large",children:s.jsxs("div",{className:"empty-state",children:[s.jsx("span",{style:{fontSize:"3rem",display:"inline-flex"},children:s.jsx(m,{size:40})}),s.jsxs("h3",{children:["No ",e," engagements"]}),s.jsx("p",{children:"active"===e?"You have no active or scheduled penetration tests.":"You have no completed penetration tests."}),"active"===e&&s.jsx(o,{variant:"primary",onClick:()=>f("request"),style:{marginTop:"1rem"},children:"Request New Pentest"})]})}):s.jsx("div",{className:"engagements-grid",children:a.map(e=>s.jsx(n,{hover3d:!0,padding:"large",shadow:"medium",children:s.jsxs("div",{className:"engagement-card",children:[s.jsxs("div",{className:"engagement-header",children:[s.jsx("h3",{className:"engagement-title",children:e.type}),s.jsx("span",{className:"status-badge",style:{background:`${z(e.status)}20`,color:z(e.status),border:`1px solid ${z(e.status)}50`},children:I(e.status)})]}),s.jsxs("div",{className:"engagement-details",children:[s.jsxs("div",{className:"detail-item",children:[s.jsx("span",{className:"detail-label",children:"Target:"}),s.jsx("span",{className:"detail-value",children:e.target})]}),s.jsxs("div",{className:"detail-item",children:[s.jsx("span",{className:"detail-label",children:"Tester:"}),s.jsx("span",{className:"detail-value",children:e.tester})]}),"scheduled"===e.status&&s.jsxs("div",{className:"detail-item",children:[s.jsx("span",{className:"detail-label",children:"Scheduled:"}),s.jsx("span",{className:"detail-value",children:L(e.scheduledDate)})]}),"in-progress"===e.status&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"detail-item",children:[s.jsx("span",{className:"detail-label",children:"Started:"}),s.jsx("span",{className:"detail-value",children:L(e.startDate)})]}),s.jsxs("div",{className:"detail-item",children:[s.jsx("span",{className:"detail-label",children:"Est. Completion:"}),s.jsx("span",{className:"detail-value",children:L(e.estimatedCompletion)})]})]}),"completed"===e.status&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"detail-item",children:[s.jsx("span",{className:"detail-label",children:"Completed:"}),s.jsx("span",{className:"detail-value",children:L(e.completedDate)})]}),e.reportAvailable&&s.jsxs("div",{className:"detail-item",children:[s.jsx("span",{className:"detail-label",children:"Report:"}),s.jsx("span",{className:"detail-value",children:s.jsx(o,{variant:"ghost",size:"small",children:"Download Report â†’"})})]})]})]}),s.jsx("div",{className:"engagement-actions",children:s.jsx(o,{variant:"secondary",size:"small",fullWidth:!0,children:"View Details"})})]})},e.id))})};return s.jsxs(s.Fragment,{children:[s.jsx(t,{}),s.jsx("div",{className:"pentest-container",children:s.jsxs("div",{className:"pentest-wrapper",children:[s.jsx("div",{className:"page-header reveal-on-scroll",children:s.jsxs("div",{children:[s.jsx("h1",{className:"page-title",children:"Penetration Testing"}),s.jsx("p",{className:"page-subtitle",children:"Request and manage security penetration testing engagements"})]})}),s.jsxs("div",{className:"tabs-container reveal-on-scroll",children:[s.jsxs("button",{className:"tab "+("request"===N?"active":""),onClick:()=>f("request"),children:[s.jsx(r,{size:16}),"Request New Test"]}),s.jsxs("button",{className:"tab "+("active"===N?"active":""),onClick:()=>f("active"),children:[s.jsx(i,{size:16}),"Active Engagements"]}),s.jsxs("button",{className:"tab "+("history"===N?"active":""),onClick:()=>f("history"),children:[s.jsx(l,{size:16}),"History"]})]}),s.jsxs("div",{className:"tab-content reveal-on-scroll",children:[S&&s.jsx(n,{padding:"medium",shadow:"small",children:s.jsx("p",{style:{margin:0,color:"var(--text-secondary)"},children:S})}),"request"===N&&s.jsxs(n,{padding:"large",shadow:"medium",children:[s.jsx("h2",{className:"section-title",children:"Request Penetration Test"}),s.jsx("p",{className:"section-subtitle",children:"Submit a request for our security team to conduct a comprehensive penetration test"}),U&&s.jsxs("div",{className:"success-message",children:[s.jsx("span",{className:"success-icon",children:s.jsx(c,{size:18})}),s.jsxs("div",{children:[s.jsx("strong",{children:"Request submitted successfully!"}),s.jsx("p",{children:"Our team will review your request and contact you within 24-48 hours."})]})]}),F.submit&&s.jsxs("div",{className:"error-message",children:[s.jsx("span",{className:"error-icon",children:s.jsx(d,{size:18})}),F.submit]}),s.jsxs("form",{onSubmit:E,className:"pentest-form",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"targetType",children:"Target Type *"}),s.jsxs("select",{id:"targetType",name:"targetType",value:T.targetType,onChange:R,className:"form-input",required:!0,children:[s.jsx("option",{value:"web-application",children:"Web Application"}),s.jsx("option",{value:"mobile-application",children:"Mobile Application"}),s.jsx("option",{value:"api",children:"API"}),s.jsx("option",{value:"network",children:"Network Infrastructure"}),s.jsx("option",{value:"physical",children:"Physical Security"}),s.jsx("option",{value:"social-engineering",children:"Social Engineering"})]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"targetUrl",children:"Target URL/Identifier *"}),s.jsx("input",{type:"text",id:"targetUrl",name:"targetUrl",value:T.targetUrl,onChange:R,placeholder:"https://example.com or 192.168.1.0/24",className:"form-input "+(F.targetUrl?"error":""),required:!0}),F.targetUrl&&s.jsx("span",{className:"field-error",children:F.targetUrl})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"targetDescription",children:"Target Description *"}),s.jsx("textarea",{id:"targetDescription",name:"targetDescription",value:T.targetDescription,onChange:R,placeholder:"Describe the target system, its purpose, and key features...",rows:4,className:"form-input "+(F.targetDescription?"error":""),required:!0}),F.targetDescription&&s.jsx("span",{className:"field-error",children:F.targetDescription}),s.jsx("span",{className:"field-hint",children:"Minimum 20 characters"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"scope",children:"Testing Scope *"}),s.jsx("textarea",{id:"scope",name:"scope",value:T.scope,onChange:R,placeholder:"Define what should and should not be tested. Include specific URLs, IP ranges, or features...",rows:4,className:"form-input "+(F.scope?"error":""),required:!0}),F.scope&&s.jsx("span",{className:"field-error",children:F.scope}),s.jsx("span",{className:"field-hint",children:"Be specific about in-scope and out-of-scope items"})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"preferredDate",children:"Preferred Start Date *"}),s.jsx("input",{type:"date",id:"preferredDate",name:"preferredDate",value:T.preferredDate,onChange:R,min:(new Date).toISOString().split("T")[0],className:"form-input "+(F.preferredDate?"error":""),required:!0}),F.preferredDate&&s.jsx("span",{className:"field-error",children:F.preferredDate})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"urgency",children:"Urgency Level"}),s.jsxs("select",{id:"urgency",name:"urgency",value:T.urgency,onChange:R,className:"form-input",children:[s.jsx("option",{value:"low",children:"Low - Routine Assessment"}),s.jsx("option",{value:"normal",children:"Normal - Standard Timeline"}),s.jsx("option",{value:"high",children:"High - Priority Engagement"}),s.jsx("option",{value:"critical",children:"Critical - Urgent Security Concern"})]})]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"additionalNotes",children:"Additional Notes (Optional)"}),s.jsx("textarea",{id:"additionalNotes",name:"additionalNotes",value:T.additionalNotes,onChange:R,placeholder:"Any additional information, special requirements, or constraints...",rows:3,className:"form-input"})]}),s.jsx("div",{className:"form-actions",children:s.jsx(o,{type:"submit",variant:"primary",size:"large",loading:y,disabled:y,children:y?"Submitting...":"Submit Request"})})]})]}),"active"===N&&B("active"),"history"===N&&B("history")]})]})})]})};export{v as default};
