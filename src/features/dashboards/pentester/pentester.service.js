/**
 * Pentester service
 */
import { API_ENDPOINTS, buildEndpoint } from '../../../config/api.config';
import { apiClient } from '../../../shared/services/api.client';

export const getAssignedPentests = async () => {
  const response = await apiClient.get(API_ENDPOINTS.PENTEST.LIST);
  if (response.success) {
    return { success: true, data: response.data || [] };
  }
  return { success: false, error: response.error || 'Failed to load pentests' };
};

export const updatePentest = async (pentestId, updates) => {
  const endpoint = buildEndpoint(API_ENDPOINTS.PENTEST.UPDATE, { id: pentestId });
  const response = await apiClient.put(endpoint, updates);
  if (response.success) {
    return { success: true, data: response.data };
  }
  return { success: false, error: response.error || 'Failed to update pentest' };
};

export const getPentestDetails = async (pentestId) => {
  const endpoint = buildEndpoint(API_ENDPOINTS.PENTEST.GET, { id: pentestId });
  const response = await apiClient.get(endpoint);
  if (response.success) {
    return { success: true, data: response.data };
  }
  return { success: false, error: response.error || 'Failed to load pentest' };
};

export const getPentestReports = async (pentestId) => {
  const endpoint = buildEndpoint(API_ENDPOINTS.PENTEST.REPORTS, { id: pentestId });
  const response = await apiClient.get(endpoint);
  if (response.success) {
    return { success: true, data: response.data };
  }
  return { success: false, error: response.error || 'Failed to load reports' };
};

export const createPentestReport = async (pentestId, payload) => {
  const endpoint = buildEndpoint(API_ENDPOINTS.PENTEST.REPORTS, { id: pentestId });
  const response = await apiClient.post(endpoint, payload);
  if (response.success) {
    return { success: true, data: response.data };
  }
  return { success: false, error: response.error || 'Failed to create report' };
};

export const updatePentestReport = async (pentestId, reportId, payload) => {
  const endpoint = buildEndpoint(API_ENDPOINTS.PENTEST.REPORT_UPDATE, { id: pentestId, reportId });
  const response = await apiClient.patch(endpoint, payload);
  if (response.success) {
    return { success: true, data: response.data };
  }
  return { success: false, error: response.error || 'Failed to update report' };
};

export const listPentesterReports = async () => {
  const response = await apiClient.get(API_ENDPOINTS.REPORTS.LIST);
  if (response.success) {
    return { success: true, data: response.data || [] };
  }
  return { success: false, error: response.error || 'Failed to load reports' };
};

export const getPentesterProfiles = async () => {
  const response = await apiClient.get(API_ENDPOINTS.PENTESTER.PROFILES);
  if (response.success) {
    return { success: true, data: response.data || [] };
  }
  return { success: false, error: response.error || 'Failed to load pentesters' };
};

export default {
  getAssignedPentests,
  updatePentest,
  getPentestDetails,
  getPentestReports,
  createPentestReport,
  updatePentestReport,
  listPentesterReports,
  getPentesterProfiles,
};
